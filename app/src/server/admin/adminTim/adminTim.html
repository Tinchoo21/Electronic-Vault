
<!DOCTYPE html>

<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title> Elektronsko vodjenje trezora | Admin Panel </title>
    <script src="https://kit.fontawesome.com/665181cd03.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="adminTim.css">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="sidebar">
        <div class="logo-details">
            <i class='bx'>
                <img src="bamcardlogo.png" width="30px" height="30px" draggable="false" />
            </i>
            <span class="logo_name">BamCard Admin</span>
        </div>
        <ul class="nav-links">
            <li>
                <a href="admin">
                    <i class='bx bx-grid-alt'></i>
                    <span class="links_name">Panel</span>
                </a>
            </li>
            <li>
                <a href="adminAnalitika">
                    <i class='bx bx-pie-chart-alt-2'></i>
                    <span class="links_name">Analitika</span>
                </a>
            </li>
            <li>
                <a href="adminKlijenti">
                    <i class='bx bx-book-alt'></i>
                    <span class="links_name">Klijenti i proizvodi</span>
                </a>
            </li>
            <li>
                <a href="adminDodajKlijenta">
                    <i class='bx bxs-book-add'></i>
                    <span class="links_name">Dodaj klijenta</span>
                </a>
            </li>
            <li>
                <a href="adminListaUposlenih">
                    <i class='bx bx-list-ul'></i>
                    <span class="links_name">Lista uposlenih</span>
                </a>
            </li>
            <li>
                <a href="adminTim" class="active">
                    <i class='bx bx-user'></i>
                    <span class="links_name">Dodaj uposlenika</span>
                </a>
            </li>
            <li class="log_out">
                <a href="logout">
                    <i class='bx bx-log-out'></i>
                    <span class="links_name">Odjavi se</span>
                </a>
            </li>
        </ul>
    </div>
    <section class="home-section">
        <nav>
            <div class="sidebar-button">
                <i class='bx bx-menu sidebarBtn'></i>
                <span class="dashboard">Dodaj uposlenika</span>
            </div>

            <div class="profile-details">
                <div class="profile-center">
                    <i class='bx bx-user'></i>
                    <span class="admin_name" id="nameAndSurname">
                        <script>
                            fetch('/nameAndSurname')
                                .then(response => response.text())
                                .then(data => {
                                    document.getElementById('nameAndSurname').textContent = data;
                                });
                        </script>
                    </span>
                </div>
            </div>
        </nav>

        <div class="home-content">
            <div class="overview-boxes">
                <div class="box">
                    <div class="right-side">
                        <div class="number">Admin <i class="fa-solid fa-user-tie"></i></div>
                        <div class="box-topic" id="adminUsers">
                            <script>
                                fetch('/totalAdminUsers')
                                    .then(response => response.text())
                                    .then(data => {
                                        document.getElementById('adminUsers').textContent = "Br. uposlenih : " + data;
                                    });
                            </script>
                        </div>
                    </div>
                </div>
                <div class="box">
                    <div class="right-side">
                        <div class="number">Trezor <i class="fa-solid fa-vault"></i></div>
                        <div class="box-topic" id="trezorUsers">

                            <script>
                                fetch('/totalTrezorUsers')
                                    .then(response => response.text())
                                    .then(data => {
                                        document.getElementById('trezorUsers').textContent = "Br. uposlenih : " + data;
                                    });
                            </script>
                        </div>

                    </div>

                </div>
                <div class="box">
                    <div class="right-side">
                        <div class="number">Person <i class="fa-solid fa-credit-card"></i></div>
                        <div class="box-topic" id="personUsers">


                            <script>
                                fetch('/totalPersonUsers')
                                    .then(response => response.text())
                                    .then(data => {
                                        document.getElementById('personUsers').textContent = "Br. uposlenih : " + data;
                                    });
                            </script>
                        </div>

                    </div>

                </div>
                <div class="box">
                    <div class="right-side">
                        <div class="number">Ukupan <i class="fa-solid fa-users-between-lines"></i> </div>
                        <div class="box-topic" id="total">


                            <script>
                                fetch('/totalNumUsers')
                                    .then(response => response.text())
                                    .then(data => {
                                        document.getElementById('total').textContent = "Br. uposlenih : " + data;
                                    });
                            </script>


                        </div>

                    </div>

                </div>
            </div>

            <div class="sales-boxes">
                <div class="recent-sales box">

                    <div class="sales-details">
                        <div class="form-style-5">
                            <form action="adduser">
                                <fieldset>
                                    <legend>Dodaj uposlenika</legend>
                                    <input type="name" name="name" id="name" placeholder="Ime *" required=""
                                           oninvalid="this.setCustomValidity('Unesite validno ime')"
                                           oninput="setCustomValidity('')">
                                    <input type="surname" name="surname" id="surname" placeholder="Prezime *" required=""
                                           oninvalid="this.setCustomValidity('Unesite validno prezime')"
                                           oninput="setCustomValidity('')">
                                    <input type="username" name="username" id="username" placeholder="Korisnicko ime *" required=""
                                           oninvalid="this.setCustomValidity('Unesite validno korisničko ime')"
                                           oninput="setCustomValidity('')">
                                    <input type="password" name="password" id="password" placeholder="Lozinka *" required=""
                                           oninvalid="this.setCustomValidity('Unesite validnu lozinku')"
                                           oninput="setCustomValidity('')">

                                    <label for="job">Odjel:</label>
                                    <select id="job" name="department" required>
                                        <optgroup label="Odjel">
                                            <option value="Admin">Admin</option>
                                            <option value="Trezor">Trezor</option>
                                            <option value="Person">Person</option>

                                        </optgroup>

                                    </select>
                                </fieldset>

                                <input type="submit" onclick="makeRequest()" value="Dodaj" />
                            </form>
                            <span id="error-message"></span>
                        </div>
                    </div>

                </div>
                <div class="top-sales box">
                    <div class="title">Uposlenici</div>
                    <ul class="top-sales-details">
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <script>
        let sidebar = document.querySelector(".sidebar");
        let sidebarBtn = document.querySelector(".sidebarBtn");
        sidebarBtn.onclick = function () {
            sidebar.classList.toggle("active");
            if (sidebar.classList.contains("active")) {
                sidebarBtn.classList.replace("bx-menu", "bx-menu-alt-right");
            } else
                sidebarBtn.classList.replace("bx-menu-alt-right", "bx-menu");
        }

        function makeRequest() {
            const form = document.querySelector('form');
            form.addEventListener('submit', function (event) {
                event.preventDefault();

                const xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4) {
                        const response = document.getElementById('error-message');
                        const data = JSON.parse(xhr.responseText);
                        if (xhr.status === 200) {

                            if (data.message === 'success') {


                                window.location.href = data.redirect;

                            }
                        }
                        else {

                            response.textContent = 'Korisničko ime je već u upotrebi';


                        }

                    }
                };
                xhr.open('POST', '/adduser');
                xhr.setRequestHeader('Content-Type', 'application/json');

                const username = document.getElementById('username').value;
                const name = document.getElementById('name').value;
                const surname = document.getElementById('surname').value;
                const password = document.getElementById('password').value;
                const department = document.getElementById('job').value;

                const data = JSON.stringify({ username, password, name, surname, department });

                xhr.send(data);
            });
        }



        let tableHtml = "";
        fetch('/userLogin')
            .then(response => response.json())
            .then(data => {
                data.forEach(user => {
                    let date = new Date(user.last_login);
                    const formattedDate = date.toLocaleString();
                    let image = "";
                    let statusClass = "";
                    if (user.department === "Admin") {
                        image = '"fa-solid fa-user-tie fa-xl"'
                    } else if (user.department === "Trezor") {
                        image = '"fa-solid fa-vault fa-xl"';
                    } else if (user.department === "Person") {
                        image = '"fa-solid fa-credit-card fa-xl"';
                    }

                    const now = new Date();
                    const isToday = now.toDateString() === date.toDateString();

                    if (isToday) {
                        statusClass = "online";
                    } else {
                        statusClass = "offline";
                    }

                    tableHtml += `<li><a draggable="false"><i id="upoIcons" class=${image}></i> <span class="product">${user.name} ${user.surname}</span></a>  <span class="${statusClass}">${formattedDate}</span></li><hr>`;
                });
                const tableContainer = document.querySelector(".top-sales-details");
                tableContainer.innerHTML = tableHtml;
            })
            .catch(error => console.error(error));
    </script>

</body>
</html>
